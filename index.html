<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nepali Bazar — Home</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Main CSS -->
  <link rel="stylesheet" href="css/styles.css">

  <script src="js/config.js"></script>
  <script src="js/product-data.js"></script>
</head>
<body class="dark-bg">

  <!-- Header -->
  <header class="site-header">
    <div class="container header-inner">
      <a href="index.html" class="brand">
        <div class="logo">NB</div>
        <div class="brand-text">
          <div class="brand-title"><span class="site-name">NEPALI BAZAR</span></div>
          <div class="brand-sub">Local Marketplace</div>
        </div>
      </a>

      <nav class="nav">
        <input id="global-search" placeholder="Search items, e.g., bike, phone" class="search-input" />
        <a href="products.html" class="nav-link">Products</a>
        <a href="sell.html" class="nav-link cta">Sell</a>
        <a href="login.html" id="login-link" class="nav-link">Login</a>
        <span id="user-info" class="nav-link" style="display:none;">
          <span id="username-display"></span> | <a href="#" id="logout-btn">Logout</a>
        </span>
      </nav>
    </div>
  </header>

  <!-- Animated hero -->
  <section class="hero">
    <div class="hero-overlay"></div>
    <div class="container hero-inner">
      <div class="hero-left">
        <h1 class="hero-title"><span class="accent site-name">NEPALI BAZAR</span><br>Buy • Sell • Connect — Locally</h1>
        <p class="hero-sub">A neon-lit marketplace for students, workers & creators. Upload your item, add contact details and photos — buyers contact you directly.</p>
        <div class="hero-cta">
          <a class="btn btn-primary" href="products.html">Browse Items</a>
          <a class="btn btn-ghost" href="sell.html">List an Item</a>
        </div>
      </div>

      <div class="hero-right">
        <div class="hero-card neon-card">
          <img src="assets/images/hero-1.jpg" alt="hero image" onerror="this.style.display='none'"/>
          <div class="meta">Featured: Gaming Laptop — Rs. 85,000</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main area: featured + grid -->
  <main class="container main-grid">
    <section class="content">
      <div class="section-head">
        <h2>Latest Listings</h2>
        <div class="controls">
          <select id="filter-category" class="select"></select>
          <select id="filter-sort" class="select">
            <option value="new">Newest</option>
            <option value="price-asc">Price: Low → High</option>
            <option value="price-desc">Price: High → Low</option>
          </select>
        </div>
      </div>

      <div id="home-grid" class="card-grid"></div>
      <div id="load-more" class="load-more-wrap">
        <button id="load-more-btn" class="btn">Load more</button>
      </div>
    </section>

    <aside class="sidebar">
      <!-- ads will be injected by app.js -->
      <div class="ad-slot"></div>
      <div class="ad-slot small"></div>

      <div class="sidebar-card">
        <h3>Post quickly</h3>
        <p class="muted">List your item in under a minute. Add photos & contact details so buyers can reach you directly.</p>
        <a class="btn btn-primary" href="sell.html">Create Listing</a>
      </div>
    </aside>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container footer-inner">
      <div>© <span id="year"></span> <span class="site-name"></span>. Made with ❤️ in Nepal.</div>
      <div class="muted">Contact: <a href="mailto:help@nepalibazar.test">help@nepalibazar.test</a></div>
    </div>
  </footer>

  <!-- Modal -->
  <div id="nb-modal" class="nb-modal">
    <div class="nb-modal-content">
      <button class="nb-modal-close">✕</button>
      <div id="nb-modal-body"></div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/app.js"></script>
  <script>
    // Year + site name
    document.getElementById('year').textContent = new Date().getFullYear();
    document.querySelectorAll('.site-name').forEach(el => el.textContent = window.SITE_NAME || 'NEPALI BAZAR');

    // Logged-in state
    const loggedUser = localStorage.getItem("nb_logged_in_user");
    const loginLink = document.getElementById("login-link");
    const userInfo = document.getElementById("user-info");
    const usernameDisplay = document.getElementById("username-display");
    const logoutBtn = document.getElementById("logout-btn");

    if (loggedUser) {
      loginLink.style.display = "none";
      userInfo.style.display = "inline";
      usernameDisplay.textContent = loggedUser;
    } else {
      loginLink.style.display = "inline";
      userInfo.style.display = "none";
    }

    logoutBtn.addEventListener("click", function(e){
      e.preventDefault();
      localStorage.removeItem("nb_logged_in_user");
      location.reload();
    });

    // Load-more button
    let homeLimit = 8;
    const btn = document.getElementById("load-more-btn");
    if(btn){
      btn.addEventListener("click", ()=>{
        homeLimit += 8;
        if(window.renderHomeGrid){
          window.renderHomeGrid(homeLimit);
        }
      });
    }

    // Populate category filter (fixed backticks)
    const catSelect = document.getElementById("filter-category");
    if (catSelect && window.NB_PRODUCTS) {
      const categories = [...new Set(window.NB_PRODUCTS.map(p => p.category))];
      catSelect.innerHTML = `<option value="">All Categories</option>` +
        categories.map(c => `<option value="${c}">${c}</option>`).join("");
    }

    // Modal open/close logic
    const modal = document.getElementById("nb-modal");
    const modalBody = document.getElementById("nb-modal-body");
    const modalClose = modal.querySelector(".nb-modal-close");

    window.NB_OPEN_MODAL = (html) => {
      modalBody.innerHTML = html;
      modal.style.display = "flex";
    };
    function closeModal(){
      modal.style.display = "none";
      modalBody.innerHTML = "";
    }
    modalClose.addEventListener("click", closeModal);
    modal.addEventListener("click", e => { if(e.target === modal) closeModal(); });
    document.addEventListener("keydown", e => { if(e.key === "Escape") closeModal(); });
  </script>
</body>
</html>
